# Миграция с Moralis на Mobula API

## Изменения

Проект был успешно обновлен для использования Mobula API вместо Moralis для получения цен токенов и криптовалютных данных.

### Основные изменения:

1. **Добавлен Mobula API SDK** - новая зависимость `mobula-api-sdk` в `package.json`
2. **Новые функции**:
   - `getTokenPriceFromMobula(tokenAddress)` - получение цены одного токена
   - `getMultipleTokenPrices(tokenAddresses)` - получение цен нескольких токенов
3. **Обновленные эндпоинты**:
   - `/checkAccount` - теперь использует Mobula для получения цен токенов
   - `/tokens` - получение цен через Mobula API
   - `/tokengraph` - получение исторических данных через Mobula
   - `/history` - обновлена функция получения исторических цен SOL

### Требования для настройки:

1. **Создайте файл `.env`** на основе `.env.example`
2. **Получите API ключ Mobula**:
   - Зарегистрируйтесь на https://admin.mobula.fi/
   - Создайте новый API ключ
   - Скопируйте ключ в переменную `MOBULA_API_KEY`

### Преимущества Mobula API:

- **Лучшая поддержка Solana**: Специализируется на данных различных блокчейнов, включая Solana
- **Исторические данные**: Предоставляет реальные исторические данные через `fetchAssetMarketHistory`
- **Множественные запросы**: Поддержка запросов нескольких активов
- **Гибкие параметры**: Поддержка различных timeframe и blockchain параметров

### Изменения в API:

Эндпоинт `/tokengraph` остается с тем же параметром `address`, но теперь:
- Поддерживает как адреса токенов Solana, так и названия активов (например, "solana" для SOL)
- Возвращает реальные исторические данные когда доступны
- Использует fallback к генерации данных на основе текущей цены

### Примеры использования:

#### Получение цены SOL:
```javascript
// Можно использовать как адрес
/tokengraph?address=So11111111111111111111111111111111111111112

// Или название актива
/tokengraph?address=solana
```

#### Получение исторических данных:
```javascript
const response = await mobula.fetchAssetMarketHistory({
    asset: 'solana',
    from: Math.floor((Date.now() - 30 * 24 * 60 * 60 * 1000) / 1000),
    to: Math.floor(Date.now() / 1000),
    timeframe: '1d'
});
```

### Удаленные зависимости:

- `moralis` - заменен на `mobula-api-sdk`

### Примечания:

1. **Исторические данные**: Mobula предоставляет реальные исторические данные, что улучшает точность графиков
2. **Кэширование**: Система кэширования сохранена и работает с новым API
3. **Обработка ошибок**: Добавлен fallback механизм для случаев, когда исторические данные недоступны
4. **Blockchain Support**: Mobula поддерживает множество блокчейнов и имеет лучшую интеграцию с Solana

### Запуск:

```bash
npm install
node main.js
```

Убедитесь, что в файле `.env` указан корректный `MOBULA_API_KEY`.

### Планы развития:

- Mobula предоставляет 300,000 бесплатных запросов в месяц
- Поддержка Premium планов для увеличенных лимитов
- Возможность получения дополнительных метрик (volume, market cap, etc.)